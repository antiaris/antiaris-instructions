# 部署篇

## APP 模块化

多 APP 架构体现的是一种模块化业务的思想。设想我们有两个应用，使用同样的技术架构，这样就会产生类似的模型，比如 view、model、controller 等等。一般地，我们会将不同的模型的实例--模块置于不同的目录中：

- view
    + header
    + content
    + footer
- controller
    + home
    + index
    + user

那么，这两个应用的模块都会混乱地放置于这些目录中，即扁平化模块。

扁平化是处理模块关系的简单方式，但要注意粒度。在诸如 view、model、controller 这种层面，扁平化只会造成命名空间的冲突，以至于目录名不得不增加很长的前缀。

模块名使用一定的命名空间是可取的，毕竟这么细的粒度很难保证每次都有符合语义的短词汇命名，关键在于命名空间如何组织。

在“应用”这个层面进行扁平化目录组织，实质上就是将命名空间以目录的形式实现。

- app1
    + view
    + controller
- app2
    + view
    + controller

## 路由

传统的 LA(N)MP 架构，是以在 HTTP Server 中设置参数的方式进行路由配置的。NodeJS 中需要框架支持，并且直接手写路由处理函数，本质上并没有太大区别，都可能会引起意外的路由指向。

我们所缺的仅仅是一个简单的路由规范，或者更简单一点——路由名字空间。继续上面多 APP 的思路，我们可以将路由前缀和应用名匹配，在应用内部定义更细的路由。如：

```js
// GET /foo/profile
router.get('/profile', () => {})
```


这需要在每个应用目录内约定一个特定的用于定义路由的文件，不妨为 "router.js"：

```js
// router.js
module.exports = router => {
    router.get(...)

    router.post(...)
};
```

目前似乎还没有特别成熟的技术能够实现修改路由后不重启 NODE 服务。